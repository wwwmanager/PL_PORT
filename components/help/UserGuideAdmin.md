
# Руководство администратора

Это руководство предназначено для продвинутых пользователей и администраторов системы. Здесь описаны функции, доступные в разделе **Настройки**.

## 1. Общие настройки

Первая вкладка позволяет управлять глобальными параметрами приложения:

-   **Парсер маршрутов**: Включение/отключение кнопки "Импорт из файла" в путевом листе.
-   **Режим работы с ПЛ**:
    *   **Driver mode (упрощенный)**: Водитель может сразу проводить ПЛ (Draft → Posted).
    *   **Central mode (с проверкой)**: ПЛ проходит через дополнительный статус "Отправлено" (Draft → Submitted → Posted).
-   **Настройки бланков**: Разрешить или запретить водителю самостоятельно добавлять пачки бланков.

## 2. Управление пользователями и ролями

-   **Пользователи**: На этой вкладке можно создавать, редактировать и удалять учетные записи пользователей. Каждому пользователю присваивается роль и могут быть добавлены дополнительные индивидуальные права.
-   **Управление ролями**: Здесь можно гибко настроить, какими правами (Capabilities) обладает каждая роль в системе. Например, можно разрешить роли "Бухгалтер" корректировать проведенные ПЛ. Роль "Администратор" нередактируема и всегда имеет все права.

## 3. Управление бланками

Эта вкладка предназначена для централизованного учета бланков строгой отчетности.

-   **Пачки бланков**: Позволяет создавать "пачки" (диапазоны номеров), материализовывать их (создавать индивидуальные записи для каждого бланка) и выдавать водителям.
-   **Все бланки**: Предоставляет полный реестр всех бланков в системе с возможностью поиска, фильтрации и массового списания.

## 4. Импорт и Экспорт данных

Эти функции позволяют создавать полные резервные копии базы данных приложения и восстанавливать их.

### Экспорт

-   **Экспорт (общий)**: Создает `.json` файл, содержащий все данные из всех справочников и документов.
-   **Экспорт (выборочный)**: При нажатии на кнопку "Экспорт" появляется модальное окно, где можно выбрать, какие именно разделы данных (ключи хранилища) вы хотите экспортировать.
-   **Экспорт пакета контекста**: Создает специальный `.json` файл, который содержит оптимизированный набор данных для передачи в AI Studio или другие инструменты анализа. В этот пакет включаются все справочники (ТС, сотрудники, организации) и последние 10 путевых листов, что позволяет AI понимать текущий контекст вашего автопарка без загрузки всей истории.

### Импорт

1.  Нажмите кнопку **"Импорт"** и выберите ранее экспортированный `.json` файл.
2.  Откроется окно **предварительного просмотра**, где будет показано, какие данные будут изменены.
3.  Для каждого раздела данных можно выбрать **стратегию импорта**:
    -   **Добавлять новые**: Будут добавлены только те записи, ID которых нет в текущей базе.
    -   **Обновлять (слияние)**: Существующие записи будут обновлены (поля из файла заменят поля в базе), но не будут перезаписаны полностью.
    -   **Обновлять (перезапись)**: Существующие записи будут полностью заменены записями из файла.
    -   **Удалять отсутствующие**: Записи, которые есть в базе, но отсутствуют в файле, будут удалены.
4.  Нажмите **"Импортировать выбранное"**. После завершения страница будет автоматически перезагружена.

> **Важно!** Перед каждым импортом система автоматически создает временную резервную копию, которую можно восстановить в случае ошибки.

## 5. Журналы аудита

-   **Журнал импорта**: Хранит детальную историю всех операций импорта данных.
    *   **Детализация**: Можно посмотреть, какие конкретно записи были добавлены, изменены или удалены в рамках каждого импорта.
    *   **Откат изменений (Rollback)**: Можно выбрать одну или несколько записей (или все событие целиком) и откатить их к состоянию, которое было *до* импорта.
    *   **Сравнение (Diff)**: Для каждой измененной записи можно открыть окно сравнения, где наглядно показаны старые и новые значения полей.

-   **Бизнес-аудит**: Высокоуровневый журнал ключевых бизнес-событий в системе (создание ПЛ, проведение, выдача бланков и т.д.). Позволяет отследить, "кто и когда" выполнил то или иное действие.

## 6. Диагностика

Эта вкладка содержит инструменты для проверки и обслуживания локальной базы данных.

-   **Окружение и поддержка**: Показывает техническую информацию о вашем браузере.
-   **Хранилище и квота**: Отображает, сколько места занимают данные приложения в хранилище браузера.
-   **Валидация БД**: Проверяет все данные на соответствие заданной схеме.
-   **Опасная зона**: Содержит функции для "тонкой" очистки данных: удаление "неизвестных" ключей, очистка журнала аудита, сброс настроек UI.
